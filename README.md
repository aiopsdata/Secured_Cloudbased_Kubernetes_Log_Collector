## Secured_Cloudbased_Kubernetes_Log_Collector
This collector is designed to collect Pod Logs, Events, Prometheus Logs and Metrices generated by different kubernetes resources.
## :mag:Prerequisites
[**Docker**](https://docs.docker.com/engine/install/) <br/>
[**Kubernetes(Minikube)**](https://minikube.sigs.k8s.io/docs/start/)<br/>
[**Helm Version 3**](https://helm.sh/docs/intro/install/)<br/>
[**Python3**](https://www.geeksforgeeks.org/download-and-install-python-3-latest-version/)
## :zap: Installation
### :cloud: Cloud Based Elasticsearch Installation
Install agents for cloud based Elasticsearch.<br>
The following installation steps will deploy Agents and allow you to store data generated by them on your Cloud based Elasticsearch.

**Enter credential using Flags**
```bash 
./install.sh -c -i CLOUD_ID -u USER_NAME -p PASSWORD -s SYSTEM_NAME -u USER_NAME
```
**OR**<br><br>
**Enter credential during runtime**
```bash
./install.sh -c
```
SYSTEM_NAME allow you to differentiate data generated by your system with other data on Elasticsearch
```
System Name cannot be empty, please enter System Name : 
SYSTEM_NAME
```
Enter your cloud Elasticsearch_Id
```
Cloud ID cannot be empty, please enter cloud ID : 
https://ELASTICSEARCH_CLOUD_ID:PORT
```
Enter your cloud User_Name
```
Cloud User cannot be empty, please enter cloud User : 
USER_NAME
```
Enter your Elasticsearch Password
```
Cloud Password cannot be empty, please enter cloud Password : 
PASSWORD
```

<br><br>
### :computer: Local Elasticsearch Installation
The following installation steps will deploy Logcollector, Metric, Node-expoter, Elasticsearch and Kibana Pods. It will also generate a **User_ID** and **Password** which will be use to authenticate Elasticsearch and Kibana.
**Enter inputs using Flags**
```bash
./install.sh -s SYSTEM_NAME -u USER_NAME
```
**OR**<br><br>
**Enter inputs during runtime**
```bash
./install.sh
```
SYSTEM_NAME allow you to differentiate data generated by your system with other data on Elasticsearch
```bash
System Name cannot be empty, please enter System Name : 
SYSTEM_NAME
```
USER_NAME will be use as a Elasticsearch Index, under which all generated data will be stored.
```bash
Enter your User name (In small cases): 
USER_NAME
```
## :umbrella:Uninstallation
```bash
./uninstall.sh
```

<br/><br/>
## :triangular_flag_on_post: Flags For Installing And Uninstalling Specific Component 
You can use all these Flags with `./uninstall.sh` script too.
<br/><br/>
For installing **Kibana**, you can user **-k** flag along with others flags
```bash
./install.sh -c -i CLOUD_ID -u USER_NAME -p PASSWORD -s SYSTEM_NAME -k
```
or
```bash
./install.sh -k
```
<br/>

For installing **Logcollector**, you can user  **-l**  flag along with other flags
```bash
./install.sh -c -i CLOUD_ID -u USER_NAME -p PASSWORD -s SYSTEM_NAME -l
```
or

```bash
./install.sh -l
```
<br/>

For installing **Metricollector**, you can user  **-m**  flag along with other flags
```bash
./install.sh -c -i CLOUD_ID -u USER_NAME -p PASSWORD -s SYSTEM_NAME -m
```
or
```bash
./install.sh -m
```
<br/><br/>
## :snowflake:Access Components After Deployment
Run ``` minikube ip ``` to get your minikube ip address, which will help you in accessing different components.
<br/>
**Access Elasticsearch**
```bash 
http://minikubeip:32000
```

**Access Kibana**
```bash 
http://minikubeip:32002
```

**Access Prometheus** 
<br/>
 For accessing prometheus you need to get the URL on which application is running then you need to forward the port to access it on your host system.
```bash 
export POD_NAME=$(kubectl get pods --namespace aiops -l "app=prometheus-node-exporter,release=node-exporter" -o jsonpath="{.items[0].metadata.name}")
```
```bash 
kubectl port-forward --namespace aiops $POD_NAME 9100
```
After above steps, prometheus will be available on.
```bash
http://localhost:9100
```
